#!/usr/bin/env python

import argparse
import simplejson as json
import csv

parser = argparse.ArgumentParser(description='A script convert between different sequence feature formats' )
parser.add_argument('--input', type=argparse.FileType('r'), help="An input feature file",\
     default='-')
parser.add_argument('--output', type=argparse.FileType('w'), help="A output feature file",\
     default='-')
parser.add_argument('--infmt', help ="Input format", choices=["csv"], default="csv") 
parser.add_argument('--outfmt', help ="Desired output format", choices=["esom-lrn"], default="esom-lrn") 
args = parser.parse_args()

# class featureset(object):
#   """ A class for a feature describing a sequence"""
#   def __init__(self):
#   self.taxid = None
#   self.feature

    
def csv2esom(csvhandle, esomhandle):
    """Returns a dictionary of features from a csv"""
    writelist = []
    elements = 0
    for i, line in enumerate(csvhandle):
        linelist =line.strip().split('\t')
        writelist.append(linelist)
        if len(linelist) > elements:
            elements = len(linelist)
    esomhandle.write("# ESOM .lrn file generated by GeneLearn " + "\n")
    esomhandle.write("% " +str(i) + "\n")
    esomhandle.write("% " + str(elements -1 ) + "\n")
    line4 = [ "9"] + ["1"]*(elements - 1)
    esomhandle.write("% " + ('\t'.join(map(str,line4)) + "\n"))
    names = []
    for j in range(elements-1):
        names.append("feat" + str(j))
    line5 = ["taxid"] + names
    esomhandle.write("% " + ('\t'.join(map(str,line5)) + "\n"))
    for vector in writelist:
        esomhandle.write("% " + ('\t'.join(map(str,vector)) + "\n"))

if args.infmt == "csv" and args.outfmt == "esom-lrn":
    csv2esom(args.input,args.output)
else:
    raise ValueError('Only csv to esom .lrn conversion is supported at this time') 